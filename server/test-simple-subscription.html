<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Debug Assinatura Simples</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        .btn { background: #007bff; color: white; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; margin: 10px; }
        .result { background: #f8f9fa; border: 1px solid #dee2e6; padding: 20px; margin-top: 20px; border-radius: 5px; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        pre { background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug Assinatura Mercado Pago</h1>
        <p>Teste com payload m√≠nimo para identificar o problema</p>

        <button class="btn" onclick="testMinimalSubscription()">üß™ Teste M√≠nimo</button>
        <button class="btn" onclick="testWithAllFields()">üìã Teste Completo</button>
        <button class="btn" onclick="testDifferentUrl()">üîó Teste URL Diferente</button>

        <div id="result"></div>
    </div>

    <script>
        const API_BASE = 'https://mvp-colab-ongs-backend.onrender.com';

        async function testMinimalSubscription() {
            const result = document.getElementById('result');
            result.innerHTML = '<p>‚è≥ Testando payload m√≠nimo...</p>';

            try {
                const payload = {
                    amount: 10.00,
                    frequency: "monthly",
                    donorName: "Teste M√≠nimo",
                    donorEmail: "teste@email.com"
                };

                console.log('Enviando payload m√≠nimo:', payload);

                const response = await fetch(`${API_BASE}/api/donations/recurring`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                result.innerHTML = `
                    <div class="result ${response.ok ? 'success' : 'error'}">
                        <h3>${response.ok ? '‚úÖ SUCESSO' : '‚ùå ERRO'} - Status: ${response.status}</h3>
                        <h4>üì§ Payload Enviado:</h4>
                        <pre>${JSON.stringify(payload, null, 2)}</pre>
                        <h4>üì• Resposta:</h4>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;

            } catch (error) {
                result.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå ERRO DE CONEX√ÉO</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }

        async function testWithAllFields() {
            const result = document.getElementById('result');
            result.innerHTML = '<p>‚è≥ Testando payload completo...</p>';

            try {
                const payload = {
                    amount: 25.00,
                    frequency: "monthly",
                    donorName: "Jo√£o Silva Completo",
                    donorEmail: "joao.completo@email.com",
                    donorPhone: "11999999999",
                    donorDocument: "12345678901",
                    donorAddress: "Rua das Flores, 123",
                    donorCity: "S√£o Paulo",
                    donorState: "SP",
                    donorZipCode: "01234-567",
                    message: "Teste com todos os campos",
                    isAnonymous: false,
                    showInPublicList: true
                };

                console.log('Enviando payload completo:', payload);

                const response = await fetch(`${API_BASE}/api/donations/recurring`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                result.innerHTML = `
                    <div class="result ${response.ok ? 'success' : 'error'}">
                        <h3>${response.ok ? '‚úÖ SUCESSO' : '‚ùå ERRO'} - Status: ${response.status}</h3>
                        <h4>üì§ Payload Enviado:</h4>
                        <pre>${JSON.stringify(payload, null, 2)}</pre>
                        <h4>üì• Resposta:</h4>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;

            } catch (error) {
                result.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå ERRO DE CONEX√ÉO</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }

        async function testDifferentUrl() {
            const result = document.getElementById('result');
            result.innerHTML = '<p>‚è≥ Testando com URL diferente...</p>';

            try {
                const payload = {
                    amount: 15.00,
                    frequency: "weekly",
                    donorName: "Maria URL Test",
                    donorEmail: "maria.url@email.com",
                    message: "Teste URL diferente"
                };

                console.log('Enviando com URL diferente:', payload);

                const response = await fetch(`${API_BASE}/api/donations/recurring`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                result.innerHTML = `
                    <div class="result ${response.ok ? 'success' : 'error'}">
                        <h3>${response.ok ? '‚úÖ SUCESSO' : '‚ùå ERRO'} - Status: ${response.status}</h3>
                        <h4>üì§ Payload Enviado:</h4>
                        <pre>${JSON.stringify(payload, null, 2)}</pre>
                        <h4>üì• Resposta:</h4>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;

            } catch (error) {
                result.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå ERRO DE CONEX√ÉO</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
