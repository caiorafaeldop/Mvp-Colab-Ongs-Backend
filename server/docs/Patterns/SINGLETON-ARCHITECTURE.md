# Singleton Pattern - Arquitetura

## ğŸ—ï¸ VisÃ£o Geral da Arquitetura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APLICAÃ‡ÃƒO                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Controllers & Services                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚              â”‚             â”‚          â”‚             â”‚
â”‚           â–¼              â–¼             â–¼          â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ConfigMgr   â”‚  â”‚  Logger  â”‚  â”‚Database â”‚  â”‚Prisma  â”‚      â”‚
â”‚  â”‚ Singleton   â”‚  â”‚ Singletonâ”‚  â”‚Singletonâ”‚  â”‚Service â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚              â”‚             â”‚           â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                         â”‚                                       â”‚
â”‚                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                                â”‚
â”‚                    â”‚ISingletonâ”‚ (Interface)                    â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Estrutura de DiretÃ³rios

```
server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â””â”€â”€ singletons/
â”‚   â”‚       â””â”€â”€ ISingleton.js Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· Interface base
â”‚   â”‚
â”‚   â””â”€â”€ infra/
â”‚       â””â”€â”€ singletons/
â”‚           â”œâ”€â”€ DatabaseConnection.js Â·Â·Â·Â·Â· ConexÃ£o MongoDB
â”‚           â”œâ”€â”€ PrismaService.js Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· Cliente Prisma
â”‚           â”œâ”€â”€ ConfigManager.js Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· ConfiguraÃ§Ãµes
â”‚           â””â”€â”€ Logger.js Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· Sistema de logs
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/singletons/
â”‚   â”‚   â”œâ”€â”€ DatabaseConnection.test.js
â”‚   â”‚   â”œâ”€â”€ PrismaService.test.js
â”‚   â”‚   â”œâ”€â”€ Logger.test.js
â”‚   â”‚   â”œâ”€â”€ ConfigManager.test.js
â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”‚
â”‚   â””â”€â”€ integration/singletons/
â”‚       â””â”€â”€ AllSingletons.test.js
â”‚
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ verify-singleton-usage.js Â·Â·Â·Â·Â·Â·Â·Â·Â· VerificaÃ§Ã£o automÃ¡tica
â”‚
â””â”€â”€ docs/patterns/
    â”œâ”€â”€ singleton.txt Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· AvaliaÃ§Ã£o (10/10)
    â”œâ”€â”€ SINGLETON-BEST-PRACTICES.md Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· Guia completo
    â”œâ”€â”€ SINGLETON-SUMMARY.md Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· Resumo executivo
    â””â”€â”€ SINGLETON-ARCHITECTURE.md Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· Este arquivo
```

---

## ğŸ”„ Fluxo de InicializaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVER STARTUP                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  1. ConfigManager      â”‚
            â”‚  getInstance()         â”‚
            â”‚  â”œâ”€ Load .env          â”‚
            â”‚  â”œâ”€ Validate config    â”‚
            â”‚  â””â”€ Setup defaults     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  2. Logger             â”‚
            â”‚  getInstance()         â”‚
            â”‚  â”œâ”€ Setup log dir      â”‚
            â”‚  â”œâ”€ Configure levels   â”‚
            â”‚  â””â”€ Start rotation     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  3. DatabaseConnection â”‚
            â”‚  getInstance()         â”‚
            â”‚  â”œâ”€ Get config URI     â”‚
            â”‚  â”œâ”€ Connect MongoDB    â”‚
            â”‚  â””â”€ Setup listeners    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  4. PrismaService      â”‚
            â”‚  getInstance()         â”‚
            â”‚  â”œâ”€ Check DATABASE_URL â”‚
            â”‚  â”œâ”€ Initialize client  â”‚
            â”‚  â””â”€ Connect or fallbackâ”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  5. Express Server     â”‚
            â”‚  Start listening       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© Diagrama de Classes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    <<abstract>>                             â”‚
â”‚                     ISingleton                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + static getInstance(): ISingleton                          â”‚
â”‚ + static destroyInstance(): void                            â”‚
â”‚ + static hasInstance(): boolean                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ extends
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚               â”‚               â”‚             â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚Database â”‚    â”‚ Prisma  â”‚    â”‚ Config  â”‚   â”‚ Logger  â”‚
    â”‚Connect  â”‚    â”‚ Service â”‚    â”‚ Manager â”‚   â”‚         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ISingleton (Interface)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ISingleton                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - static instance: ISingleton                   â”‚
â”‚ - static _creating: boolean                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + static getInstance(): ISingleton              â”‚
â”‚   â”‚ 1. First check (instance exists?)           â”‚
â”‚   â”‚ 2. Acquire lock (_creating flag)            â”‚
â”‚   â”‚ 3. Second check (double-check)              â”‚
â”‚   â”‚ 4. Create instance                          â”‚
â”‚   â”‚ 5. Release lock                             â”‚
â”‚   â””â”€ Return instance                            â”‚
â”‚                                                 â”‚
â”‚ + static destroyInstance(): void                â”‚
â”‚   â””â”€ Set instance to null                      â”‚
â”‚                                                 â”‚
â”‚ + static hasInstance(): boolean                 â”‚
â”‚   â””â”€ Return !!instance                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### DatabaseConnection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           DatabaseConnection                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - connection: mongoose.Connection                â”‚
â”‚ - isConnected: boolean                           â”‚
â”‚ - connectionString: string                       â”‚
â”‚ - options: Object                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + connect(uri, options): Promise<Connection>     â”‚
â”‚ + disconnect(): Promise<void>                    â”‚
â”‚ + ping(): Promise<boolean>                       â”‚
â”‚ + getStatus(): Object                            â”‚
â”‚ + getStats(): Promise<Object>                    â”‚
â”‚ - setupEventListeners(): void                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PrismaService

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             PrismaService                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - prisma: PrismaClient                           â”‚
â”‚ - isConnected: boolean                           â”‚
â”‚ - connectionAttempts: number                     â”‚
â”‚ - maxRetries: number                             â”‚
â”‚ - fallbackMode: boolean                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + initialize(options): Promise<PrismaClient>     â”‚
â”‚ + connect(): Promise<void>                       â”‚
â”‚ + disconnect(): Promise<void>                    â”‚
â”‚ + getClient(): PrismaClient                      â”‚
â”‚ + ping(): Promise<boolean>                       â”‚
â”‚ + getStats(): Promise<Object>                    â”‚
â”‚ + transaction(callback): Promise<any>            â”‚
â”‚ + queryRaw(query, params): Promise<any>          â”‚
â”‚ - setupEventHandlers(): void                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ConfigManager

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ConfigManager                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - config: Object                                 â”‚
â”‚ - environment: string                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + get(key, defaultValue): any                    â”‚
â”‚ + set(key, value): void                          â”‚
â”‚ + getAll(): Object                               â”‚
â”‚ + getSection(section): Object                    â”‚
â”‚ + has(key): boolean                              â”‚
â”‚ + validate(): Object                             â”‚
â”‚ + reload(): void                                 â”‚
â”‚ - loadConfig(): void                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Logger

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Logger                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - logLevel: string                               â”‚
â”‚ - logFile: string                                â”‚
â”‚ - logDir: string                                 â”‚
â”‚ - maxFileSize: number                            â”‚
â”‚ - maxFiles: number                               â”‚
â”‚ - levels: Object                                 â”‚
â”‚ - colors: Object                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + error(message, meta): void                     â”‚
â”‚ + warn(message, meta): void                      â”‚
â”‚ + info(message, meta): void                      â”‚
â”‚ + debug(message, meta): void                     â”‚
â”‚ + http(req, res, duration): void                 â”‚
â”‚ + event(event, data): void                       â”‚
â”‚ + performance(operation, duration, meta): void   â”‚
â”‚ + getStats(): Object                             â”‚
â”‚ + setLevel(level): void                          â”‚
â”‚ - setupLogDirectory(): void                      â”‚
â”‚ - shouldLog(level): boolean                      â”‚
â”‚ - formatMessage(level, msg, meta): string        â”‚
â”‚ - writeToFile(message): void                     â”‚
â”‚ - rotateLogFile(path): void                      â”‚
â”‚ - cleanOldLogFiles(): void                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ Thread-Safety: Double-Checked Locking

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Thread 1              Thread 2              Thread 3â”‚
â”‚              â”‚                     â”‚                     â”‚   â”‚
â”‚              â”œâ”€ getInstance() â”€â”€â”€â”€â–ºâ”‚                     â”‚   â”‚
â”‚              â”‚  First check         â”‚                     â”‚   â”‚
â”‚              â”‚  instance == null?   â”‚                     â”‚   â”‚
â”‚              â”‚        â–¼             â”‚                     â”‚   â”‚
â”‚              â”‚      YES             â”‚                     â”‚   â”‚
â”‚              â”‚        â”‚             â”‚                     â”‚   â”‚
â”‚              â”‚  Acquire lock        â”‚                     â”‚   â”‚
â”‚              â”‚  (_creating = true)  â”‚                     â”‚   â”‚
â”‚              â”‚        â”‚             â”‚                     â”‚   â”‚
â”‚              â”‚  Second check  â—„â”€â”€â”€â”€â”€â”¼â”€ getInstance()     â”‚   â”‚
â”‚              â”‚  instance == null?   â”‚  First check       â”‚   â”‚
â”‚              â”‚        â–¼             â”‚  instance == null? â”‚   â”‚
â”‚              â”‚      YES             â”‚       â–¼            â”‚   â”‚
â”‚              â”‚        â”‚             â”‚      YES           â”‚   â”‚
â”‚              â”‚  Create instance     â”‚       â”‚            â”‚   â”‚
â”‚              â”‚  instance = new()    â”‚  WAIT (lock held)  â”‚   â”‚
â”‚              â”‚        â”‚             â”‚       â”‚            â”‚   â”‚
â”‚              â”‚  Release lock        â”‚       â”‚            â”‚   â”‚
â”‚              â”‚  (_creating = false) â”‚       â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚              â”‚        â”‚             â”‚       â”‚            â”‚   â”‚
â”‚              â”‚  Return instance â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚   â”‚
â”‚              â”‚                      â”‚       â”‚            â”‚   â”‚
â”‚              â”‚                      â”‚  First check       â”‚   â”‚
â”‚              â”‚                      â”‚  instance != null  â”‚   â”‚
â”‚              â”‚                      â”‚       â–¼            â”‚   â”‚
â”‚              â”‚                      â”‚  Return instance   â”‚   â”‚
â”‚              â”‚                      â”‚  (NO lock needed) â”€â”¼â”€â”€â”€â”¤
â”‚              â–¼                      â–¼                    â–¼   â”‚
â”‚         [SAME INSTANCE]     [SAME INSTANCE]     [SAME INSTANCE]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Vantagens:
âœ… Previne mÃºltiplas instÃ¢ncias
âœ… Thread-safe
âœ… Performance otimizada (lock apenas na primeira vez)
âœ… Suporta ambientes concorrentes
```

---

## ğŸ”„ Ciclo de Vida

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  [Not Created] â”€â”€getInstance()â”€â”€â–º [Created & Initialized]  â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚                                    â–¼                â”‚
â”‚       â”‚                              [In Use]               â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚                                    â”œâ”€ Methods       â”‚
â”‚       â”‚                                    â”œâ”€ Health checks â”‚
â”‚       â”‚                                    â””â”€ Operations    â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚                                    â–¼                â”‚
â”‚       â”‚                           destroyInstance()         â”‚
â”‚       â”‚                                    â”‚                â”‚
â”‚       â”‚                                    â–¼                â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º [Destroyed]           â”‚
â”‚                                            â”‚                â”‚
â”‚                                            â”œâ”€ Resources     â”‚
â”‚                                            â”‚   released     â”‚
â”‚                                            â””â”€ Instance      â”‚
â”‚                                                null         â”‚
â”‚                                                             â”‚
â”‚  Pode ser recriado: getInstance() inicia novo ciclo        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª EstratÃ©gia de Testes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TESTES UNITÃRIOS                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ 1. Singleton Pattern                           â”‚        â”‚
â”‚  â”‚    â”œâ”€ InstÃ¢ncia Ãºnica                          â”‚        â”‚
â”‚  â”‚    â”œâ”€ getInstance() retorna mesma ref          â”‚        â”‚
â”‚  â”‚    â””â”€ hasInstance() funciona                   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ 2. ReconexÃ£o                                   â”‚        â”‚
â”‚  â”‚    â”œâ”€ destroyInstance limpa corretamente       â”‚        â”‚
â”‚  â”‚    â”œâ”€ Nova instÃ¢ncia apÃ³s destruiÃ§Ã£o           â”‚        â”‚
â”‚  â”‚    â””â”€ Estado independente entre ciclos         â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ 3. Thread Safety                               â”‚        â”‚
â”‚  â”‚    â”œâ”€ Chamadas concorrentes a getInstance()    â”‚        â”‚
â”‚  â”‚    â”œâ”€ Race conditions prevenidas               â”‚        â”‚
â”‚  â”‚    â””â”€ MÃºltiplas destruiÃ§Ãµes simultÃ¢neas        â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ 4. Funcionalidades EspecÃ­ficas                 â”‚        â”‚
â”‚  â”‚    â”œâ”€ Health checks                            â”‚        â”‚
â”‚  â”‚    â”œâ”€ Status e estatÃ­sticas                    â”‚        â”‚
â”‚  â”‚    â””â”€ OperaÃ§Ãµes principais                     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 TESTES DE INTEGRAÃ‡ÃƒO                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ CoordenaÃ§Ã£o entre Singletons                   â”‚        â”‚
â”‚  â”‚    â”œâ”€ Todos criados independentemente          â”‚        â”‚
â”‚  â”‚    â”œâ”€ ReferÃªncias separadas                    â”‚        â”‚
â”‚  â”‚    â””â”€ Health check integrado                   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Ciclos de Vida Completos                       â”‚        â”‚
â”‚  â”‚    â”œâ”€ MÃºltiplos ciclos criaÃ§Ã£o/destruiÃ§Ã£o      â”‚        â”‚
â”‚  â”‚    â”œâ”€ Sem memory leaks                         â”‚        â”‚
â”‚  â”‚    â””â”€ Estado limpo entre ciclos                â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š MÃ©tricas e Monitoramento

### Health Check Endpoint

```javascript
GET /health

Response:
{
  "status": "healthy",
  "singletons": {
    "database": {
      "hasInstance": true,
      "isConnected": true,
      "ping": true
    },
    "prisma": {
      "hasInstance": true,
      "isReady": true,
      "fallbackMode": false
    },
    "config": {
      "hasInstance": true,
      "validation": {
        "valid": true,
        "warnings": []
      }
    },
    "logger": {
      "hasInstance": true,
      "logLevel": "info",
      "fileSize": 1024576
    }
  },
  "timestamp": "2025-09-30T12:00:00.000Z"
}
```

---

## ğŸ¯ PadrÃµes de Design Relacionados

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  Singleton â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚      â”‚                  â”‚                                   â”‚
â”‚      â”‚ usa              â”‚ complementa                       â”‚
â”‚      â–¼                  â”‚                                   â”‚
â”‚  Factory Pattern â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚      â”‚                                                      â”‚
â”‚      â”‚ cria                                                 â”‚
â”‚      â–¼                                                      â”‚
â”‚  Repositories                                               â”‚
â”‚      â”‚                                                      â”‚
â”‚      â”‚ implementa                                           â”‚
â”‚      â–¼                                                      â”‚
â”‚  Strategy Pattern                                           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### IntegraÃ§Ã£o com Outros PadrÃµes

- **Factory:** Singletons sÃ£o usados dentro de Factories
- **Repository:** ConfigManager e Logger usados em Repositories
- **Strategy:** AlternÃ¢ncia entre MongoDB e Prisma
- **Observer:** Logger subscreve a eventos do sistema
- **Facade:** Singletons simplificam acesso a recursos complexos

---

## ğŸ“ Notas de ImplementaÃ§Ã£o

### Por Que Double-Checked Locking?

1. **Performance:** Lock apenas na primeira criaÃ§Ã£o
2. **Thread-Safety:** Previne race conditions
3. **Simplicidade:** FÃ¡cil de entender e manter
4. **JavaScript:** Funciona bem em ambiente Node.js

### Alternativas Consideradas

âŒ **Eager Initialization:** Criaria instÃ¢ncia no load do mÃ³dulo
   - Problema: NÃ£o permite testes com destroyInstance()
   
âŒ **Simple Lock:** Lock em toda chamada getInstance()
   - Problema: Performance degradada

âœ… **Double-Checked Locking:** Melhor trade-off

---

## ğŸ” Debugging e Troubleshooting

### Como Verificar Estado

```javascript
// Verificar se instÃ¢ncia existe
console.log(DatabaseConnection.hasInstance()); // true/false

// Obter status
const db = DatabaseConnection.getInstance();
console.log(db.getStatus());

// Health check
const isHealthy = await db.ping();
console.log('Database healthy:', isHealthy);

// EstatÃ­sticas
const stats = await db.getStats();
console.log('Database stats:', stats);
```

### Logs de Debug

Todos os singletons logam eventos importantes:
- `[SingletonName] Nova instÃ¢ncia criada`
- `[SingletonName] InstÃ¢ncia destruÃ­da`
- `[SingletonName] Conectado/Desconectado`

---

## ğŸ“ ReferÃªncias AcadÃªmicas

- **Gang of Four** - Design Patterns (1994)
- **Martin Fowler** - Patterns of Enterprise Application Architecture
- **Robert C. Martin** - Clean Architecture
- **Joshua Bloch** - Effective Java (Singleton chapter)

---

*Diagrama de arquitetura do padrÃ£o Singleton*
*VersÃ£o 2.0 - Nota 10/10*
*Ãšltima atualizaÃ§Ã£o: 2025-09-30*
